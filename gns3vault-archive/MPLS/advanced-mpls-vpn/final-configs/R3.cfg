!
!
version 12.4
service timestamps debug datetime msec
service timestamps log datetime msec
no service password-encryption
!
hostname PE1
!
boot-start-marker
boot-end-marker
!
!
no aaa new-model
memory-size iomem 5
!
!
ip cef
no ip domain lookup
!
!
ip vrf CENTRALSERVER
 rd 444:444
 route-target export 444:444
 route-target export 124:124
 route-target import 444:444
 route-target import 456:456
!
ip vrf COCO
 rd 333:333
 import map ALLOWIN
 export map SELECTIVE
 route-target export 333:333
 route-target export 456:456
 route-target export 777:777
 route-target import 333:333
 route-target import 124:124
 route-target import 777:777
 route-target import 666:666
!
ip vrf INTERNET
 rd 555:555
 route-target export 555:555
 route-target export 666:666
 route-target import 555:555
 route-target import 777:777
!
ip vrf MELON
 rd 222:222
 export map SELECTIVE
 route-target export 222:222
 route-target export 123:123
 route-target import 222:222
 route-target import 123:123
!
ip vrf PALM
 rd 111:111
 import map ALLOWIN
 export map SELECTIVE
 route-target export 111:111
 route-target export 123:123
 route-target export 456:456
 route-target export 777:777
 route-target import 111:111
 route-target import 123:123
 route-target import 124:124
 route-target import 777:777
 route-target import 666:666
!
!
no mpls ip propagate-ttl 
mpls ldp neighbor 4.4.4.4 password cisco
!
!
!
!
!
!
!
!
!
!
!
!
!
!
!
!
! 
!
!
!
!
interface Loopback0
 ip address 3.3.3.3 255.255.255.0
 ip ospf network point-to-point
!
interface Loopback1
 ip vrf forwarding MELON
 ip address 33.33.33.33 255.255.255.255
!
interface Ethernet0/0
 ip address 192.168.34.3 255.255.255.0
 half-duplex
 mpls ip
!
interface Ethernet0/1
 ip vrf forwarding CENTRALSERVER
 ip address 192.168.39.3 255.255.255.0
 half-duplex
!
interface Ethernet0/2
 ip vrf forwarding PALM
 ip address 192.168.13.3 255.255.255.0
 half-duplex
!
interface Ethernet0/3
 ip vrf forwarding MELON
 ip address 192.168.23.3 255.255.255.0
 half-duplex
!
interface Ethernet1/0
 ip vrf forwarding COCO
 ip vrf sitemap SOO
 ip address 192.168.36.3 255.255.255.0
 half-duplex
!
interface Ethernet1/1
 no ip address
 half-duplex
!
interface Ethernet1/2
 no ip address
 shutdown
 half-duplex
!
interface Ethernet1/3
 no ip address
 shutdown
 half-duplex
!
router eigrp 3
 auto-summary
 !
 address-family ipv4 vrf COCO
  redistribute bgp 1 metric 1 1 1 1 1
  network 192.168.36.0
  no auto-summary
  autonomous-system 3
 exit-address-family
!
router ospf 2 vrf MELON
 log-adjacency-changes
 area 0 sham-link 33.33.33.33 55.55.55.55 cost 10
 redistribute bgp 1 subnets
 network 192.168.23.0 0.0.0.255 area 0
!
router ospf 3 vrf CENTRALSERVER
 log-adjacency-changes
 redistribute bgp 1 subnets
 network 192.168.39.0 0.0.0.255 area 0
!
router ospf 1
 log-adjacency-changes
 network 3.3.3.0 0.0.0.255 area 0
 network 192.168.34.0 0.0.0.255 area 0
!
router rip
 !
 address-family ipv4 vrf PALM
  redistribute bgp 1 metric transparent
  network 192.168.13.0
  no auto-summary
  version 2
 exit-address-family
!
router bgp 1
 no synchronization
 bgp log-neighbor-changes
 neighbor 5.5.5.5 remote-as 1
 neighbor 5.5.5.5 update-source Loopback0
 no auto-summary
 !
 address-family vpnv4
  neighbor 5.5.5.5 activate
  neighbor 5.5.5.5 send-community both
 exit-address-family
 !
 address-family ipv4 vrf PALM
  redistribute rip
  no synchronization
 exit-address-family
 !
 address-family ipv4 vrf MELON
  redistribute ospf 2 vrf MELON
  no synchronization
  network 33.33.33.33 mask 255.255.255.255
 exit-address-family
 !
 address-family ipv4 vrf INTERNET
  no synchronization
 exit-address-family
 !
 address-family ipv4 vrf COCO
  redistribute eigrp 3
  neighbor 192.168.36.6 remote-as 3
  neighbor 192.168.36.6 activate
  neighbor 192.168.36.6 route-map SOO in
  no synchronization
 exit-address-family
 !
 address-family ipv4 vrf CENTRALSERVER
  redistribute ospf 3 vrf CENTRALSERVER
  no synchronization
 exit-address-family
!
ip http server
no ip http secure-server
!
!
!
access-list 10 permit 99.99.99.0 0.0.0.255
!
route-map SELECTIVE permit 10
 match ip address 10
 set extcommunity rt  555:555 additive
!
route-map SELECTIVE permit 20
!
route-map SOO permit 10
 set extcommunity soo 100:1
!
route-map ALLOWIN deny 10
 match ip address 10
!
route-map ALLOWIN permit 20
!
!
mpls ldp router-id Loopback0 force
!
control-plane
!
!
!
!
!
!
!
!
!
!
line con 0
line aux 0
line vty 0 4
 login
!
!
end
